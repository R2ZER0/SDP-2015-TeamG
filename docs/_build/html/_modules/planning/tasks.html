

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>planning.tasks &mdash; SDP  documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="SDP  documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> SDP</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../action.html">Action class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controller.html">Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../planning.html">Planning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../planning.html#module-planning.collisions">Collisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../planning.html#module-planning.models">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../planning.html#module-planning.planner">Planner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../planning.html#module-planning.tasks">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../planning.html#module-planning.utilities">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../postprocessing.html">Postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prediction.html">Prediction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../prediction.html#datascraper-ball">DataScraper (Ball)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prediction.html#module-prediction.Prediction">Prediction Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulator.html">Simulator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../simulator.html#simulated-camera">Simulated Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator.html#simulated-actoin">Simulated Actoin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simulator.html#id1">Simulator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../testing.html">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../testing.html#test-angle">Test Angle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vision.html">Vision</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#module-vision.calibrate">Croppings Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#module-vision.colors">Color Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#threshold-gui">Threshold GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#module-vision.tools">Vision Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#module-vision.tracker">Trackers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vision.html#id1">Vision</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">SDP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>planning.tasks</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for planning.tasks</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">action</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="sd">&#39;&#39;&#39;Task base class. Execute function must be implemented by inheriting</span>
<span class="sd">classes.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="Task"><a class="viewcode-back" href="../../planning.html#planning.tasks.Task">[docs]</a><span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">ATTACKER</span><span class="o">=</span><span class="s">&#39;attacker&#39;</span>
    <span class="n">DEFENDER</span><span class="o">=</span><span class="s">&#39;defender&#39;</span>

    <span class="sd">&#39;&#39;&#39;Initialise this task.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">Task</span><span class="o">.</span><span class="n">ATTACKER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">our_attacker</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">Task</span><span class="o">.</span><span class="n">DEFENDER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">our_defender</span>

    <span class="sd">&#39;&#39;&#39;Carries out this task. Should call the functions of the Action</span>
<span class="sd">    object to carry out the actions required to complete this task.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="Task.execute"><a class="viewcode-back" href="../../planning.html#planning.tasks.Task.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="AcquireBall"><a class="viewcode-back" href="../../planning.html#planning.tasks.AcquireBall">[docs]</a><span class="k">class</span> <span class="nc">AcquireBall</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Acquire Ball task. Rotate to face the ball, move to an appropriate</span>
<span class="sd">    distance from it and then attempt to catch it.&#39;&#39;&#39;</span>

    <span class="c">#: Largest angle (0 - MAX_ANGLE_THRESHOLD) between the robot and the ball \</span>
    <span class="c">#: before we need to turn to face the robot.</span>
    <span class="n">ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="c">#: Distance the robot must be from the ball in order to catch it</span>
    <span class="n">CATCH_DISTANCE</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="c">#: Becomes True once this Task has caught the blal</span>
    <span class="n">complete</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">#: True indicates we were still turning on the last call</span>
    <span class="n">turning</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AcquireBall</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">)</span>

<div class="viewcode-block" id="AcquireBall.execute"><a class="viewcode-back" href="../../planning.html#planning.tasks.AcquireBall.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Executes another round of this Task. Performs as follows:</span>

<span class="sd">        * Check if our angle is on target; if not, adjust by rotating.</span>
<span class="sd">        * Otherwise, if our catcher is closed, open it up.</span>
<span class="sd">        * Check if we&#39;re close enough to catch; if not, move forward.</span>
<span class="sd">        * Otherwise, attempt to catch the ball.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">ball_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">x</span>
        <span class="n">ball_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">y</span>

        <span class="c">#Work out the angle between the robot&#39;s orientation and the ball.</span>
        <span class="n">angle_to_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_rotation_to_point</span><span class="p">(</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">)</span>
        
        <span class="c"># If the robot is not facing the point...</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_to_turn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANGLE_THRESHOLD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">turning</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># Rotation speed decreases as the angle required decreases.</span>
            <span class="c">#rotation_speed = 40 * math.log10(abs(angle_to_turn))</span>
            <span class="n">rotation_speed</span> <span class="o">=</span> <span class="mi">40</span>
            <span class="k">print</span> <span class="n">angle_to_turn</span>
            <span class="c">#Turn left or right.</span>
            <span class="k">if</span> <span class="n">angle_to_turn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning clockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="n">rotation_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning anticlockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="o">-</span><span class="n">rotation_speed</span><span class="p">)</span>

        <span class="c">#Otherwise, move toward the ball.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turning</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">turning</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c">#Open the catcher.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">catcher</span> <span class="o">==</span> <span class="s">&#39;closed&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">open_catcher</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">open_catcher</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">catcher</span> <span class="o">=</span> <span class="s">&#39;open&#39;</span>
                <span class="k">return</span>

            <span class="c">#Find the distance to the ball.</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_displacement_to_point</span><span class="p">(</span><span class="n">ball_x</span><span class="p">,</span><span class="n">ball_y</span><span class="p">)</span>

            <span class="c">#If we are too far away, move closer.</span>
            <span class="k">if</span> <span class="n">displacement</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CATCH_DISTANCE</span><span class="p">:</span>
                <span class="n">move_speed</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">move_speed</span><span class="p">)</span>

            <span class="c">#Otherwise, attempt to catch the ball.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">catcher</span> <span class="o">==</span> <span class="s">&#39;open&#39;</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Closed&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">catch</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">catch</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">catcher</span> <span class="o">=</span> <span class="s">&#39;closed&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
</div></div>
<div class="viewcode-block" id="MoveToPoint"><a class="viewcode-back" href="../../planning.html#planning.tasks.MoveToPoint">[docs]</a><span class="k">class</span> <span class="nc">MoveToPoint</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Movement Task. Rotates our Robot to face the point (x,y) and travels</span>
<span class="sd">    to it within some threshold.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#: Largest angle threshold that we allow</span>
    <span class="n">MAX_ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="c">#: Lower angle threshold as we get closer to the ball</span>
    <span class="n">MIN_ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="c">#: Distance threshold to the point before considering ourselves done</span>
    <span class="n">DISP_TOLERANCE</span> <span class="o">=</span> <span class="mi">45</span>

    <span class="c">#: Specified x-position to travel to</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c">#: Specified y-position to travel to</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">#: Assigned True once we reach the point within the threshold</span>
    <span class="n">complete</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialises this task. (x,y) represent the point on the pitch to</span>
<span class="sd">        move to.&#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MoveToPoint</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<div class="viewcode-block" id="MoveToPoint.execute"><a class="viewcode-back" href="../../planning.html#planning.tasks.MoveToPoint.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">custom_rotation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">custom_speed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Executes another round of this Task. Performs as follows:</span>

<span class="sd">        * Check if our angle is on target; if not, adjust by rotating.</span>
<span class="sd">        * Check if we&#39;re close enough; if not, move forward.</span>
<span class="sd">        * Otherwise, we&#39;re done.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Find the distance to the point x,y.</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_displacement_to_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_speed</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">displacement</span> <span class="o">+</span> <span class="mi">10</span>

        <span class="c"># Angle threshold decreases as the robot nears the point (x,y).</span>
        <span class="k">if</span> <span class="n">custom_threshold</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">angle_threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">displacement</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_ANGLE_THRESHOLD</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIN_ANGLE_THRESHOLD</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIN_ANGLE_THRESHOLD</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle_threshold</span> <span class="o">=</span> <span class="n">custom_threshold</span>

        <span class="c"># Find out the angle between (x,y) and the robot&#39;s orientation.</span>
        <span class="n">angle_to_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_rotation_to_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c"># Offset the angle to compensate for overshooting</span>
        <span class="k">if</span> <span class="n">custom_rotation</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">angle_to_turn</span> <span class="o">=</span> <span class="n">angle_to_turn</span> <span class="o">+</span> <span class="n">pi</span><span class="o">/</span><span class="mi">5</span> <span class="k">if</span> <span class="n">angle_to_turn</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">angle_to_turn</span> <span class="o">-</span> <span class="n">pi</span><span class="o">/</span><span class="mi">5</span>

        <span class="c"># If the robot is not facing the point...</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_to_turn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">angle_threshold</span><span class="p">:</span>

            <span class="c"># Rotation speed decreases as the angle required decreases.</span>
            <span class="c">#rotation_speed = 40 * math.log10(abs(angle_to_turn))</span>
            <span class="k">if</span> <span class="n">custom_rotation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rotation_speed</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rotation_speed</span> <span class="o">=</span> <span class="n">custom_rotation</span>

            <span class="k">print</span> <span class="n">angle_to_turn</span>
            <span class="c">#Turn left or right.</span>
            <span class="k">if</span> <span class="n">angle_to_turn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning clockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="n">rotation_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning anticlockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="o">-</span><span class="n">rotation_speed</span><span class="p">)</span>

        <span class="c"># If the robot is facing the point...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the robot is too far away...</span>
            <span class="k">if</span> <span class="n">displacement</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DISP_TOLERANCE</span><span class="p">:</span>
                <span class="n">move_speed</span> <span class="o">=</span> <span class="mi">100</span>

                <span class="k">if</span> <span class="n">custom_speed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">move_speed</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">move_speed</span><span class="p">,</span><span class="n">custom_speed</span><span class="p">)</span>
            <span class="c"># Else the robot has completed the task.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
</div></div>
<div class="viewcode-block" id="TurnToPoint"><a class="viewcode-back" href="../../planning.html#planning.tasks.TurnToPoint">[docs]</a><span class="k">class</span> <span class="nc">TurnToPoint</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Rotation Task; allows turning of the Robot to face a given point to</span>
<span class="sd">    within some threshold.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#: Margin of error allowed in this angle, radians.</span>
    <span class="n">ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.5</span>
    
    <span class="c">#: Our target x-position</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c">#: Our target y-position</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c">#: Gets assigned True once the Robot has rotated to the angle within accepted range.</span>
    <span class="n">complete</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TurnToPoint</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<div class="viewcode-block" id="TurnToPoint.execute"><a class="viewcode-back" href="../../planning.html#planning.tasks.TurnToPoint.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Executes another round of this Task. Performs as follows:</span>

<span class="sd">        * Check if our angle is on target; if not, adjust by rotating.</span>
<span class="sd">        * Otherwise, we&#39;re done.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="k">return</span>

            <span class="c"># Find the angle between the robot&#39;s orientation and the point.</span>
        <span class="n">angle_to_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_rotation_to_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        
        <span class="c"># If the robot is not facing the point...</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_to_turn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANGLE_THRESHOLD</span><span class="p">:</span>

            <span class="c"># Rotation speed decreases as the angle required decreases.</span>
            <span class="c">#rotation_speed = 40 * math.log10(abs(angle_to_turn))</span>
            <span class="n">rotation_speed</span> <span class="o">=</span> <span class="mi">40</span>
            <span class="k">print</span> <span class="n">angle_to_turn</span>
            <span class="c">#Turn left or right.</span>
            <span class="k">if</span> <span class="n">angle_to_turn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning clockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="n">rotation_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Turning anticlockwise&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="o">-</span><span class="n">rotation_speed</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="KickToPoint"><a class="viewcode-back" href="../../planning.html#planning.tasks.KickToPoint">[docs]</a><span class="k">class</span> <span class="nc">KickToPoint</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generic kick to point task. Rotate to face the point (x,y) and kick.&#39;&#39;&#39;</span>

    <span class="c">#: Allowed margin of error between the desired angle and ours.</span>
    <span class="n">ANGLE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.2</span>
    
    <span class="c">#: The target x-point to kick to.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c">#: The target y-point to kick to.</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">#: Assigned True when the Task has kicked the ball</span>
    <span class="n">kicked</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">#: This increases through various values as we perform checks to ensure \</span>
    <span class="c">#: we&#39;re on target to kick accurately.</span>
    <span class="n">check_state</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KickToPoint</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<div class="viewcode-block" id="KickToPoint.execute"><a class="viewcode-back" href="../../planning.html#planning.tasks.KickToPoint.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Executes another round of this Task. Performs as follows:</span>

<span class="sd">        * Check if our angle is on target; if not, adjust by rotating.</span>
<span class="sd">        * Work through check states; checking angle is still on point, \</span>
<span class="sd">          opening catcher, waiting, then kicking.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kicked</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Find the angle between the robot&#39;s orientation and the point.</span>
        <span class="n">angle_to_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">get_rotation_to_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c"># If the robot is not facing the point...</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_to_turn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANGLE_THRESHOLD</span><span class="p">:</span>

            <span class="c"># Rotation speed decreases as the angle required decreases.</span>
            <span class="c">#rotation_speed = 40 * math.log10(abs(angle_to_turn))</span>
            <span class="n">rotation_speed</span> <span class="o">=</span> <span class="mi">40</span>
            <span class="c">#Turn left or right.</span>
            <span class="k">if</span> <span class="n">angle_to_turn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="n">rotation_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">turn</span><span class="p">(</span><span class="o">-</span><span class="n">rotation_speed</span><span class="p">)</span>

        <span class="c">#Else the robot is facing the point...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_to_turn</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANGLE_THRESHOLD</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">open_catcher</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot_info</span><span class="o">.</span><span class="n">catcher</span> <span class="o">=</span> <span class="s">&#39;open&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">kick</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_state</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kicked</span> <span class="o">=</span> <span class="bp">True</span>
</div></div>
<div class="viewcode-block" id="Shoot"><a class="viewcode-back" href="../../planning.html#planning.tasks.Shoot">[docs]</a><span class="k">class</span> <span class="nc">Shoot</span><span class="p">(</span><span class="n">KickToPoint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Simple Shoot task. Rotates the robot to face the goal and then kicks.&#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">their_goal</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">their_goal</span><span class="o">.</span><span class="n">y</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Shoot</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">world</span><span class="p">,</span><span class="n">robot</span><span class="p">,</span><span class="n">role</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Author.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>